---
layout: base.njk
title: "Reservas y contacto"
description: "Solicita disponibilidad para Casa Bardena Negra o reserva desde Rurive."
permalink: "/reservas/"
---

<section class="container prose">
  <div class="card">
    <h1>Solicitar disponibilidad</h1>

    <form name="reserva"
      method="POST"
      action="/gracias/"
      data-netlify="true"
      netlify-honeypot="bot-field"
      accept-charset="UTF-8">

      <input type="hidden" name="form-name" value="reserva">

      <!-- Honeypot (no borrar) -->
      <p class="sr-only" aria-hidden="true">
        <label>Si ves este campo, déjalo vacío
          <input type="text" name="bot-field" tabindex="-1" autocomplete="off">
        </label>
      </p>

      <div class="grid cols-2">
        <p class="field">
          <label for="name">Nombre</label>
          <input required id="name" name="name" type="text" placeholder="Tu nombre" autocomplete="name">
        </p>
        <p class="field">
          <label for="email">Email</label>
          <input required id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email" inputmode="email">
        </p>
      </div>

      <div class="grid cols-2">
        <p class="field">
          <label for="checkin">Entrada</label>
          <input required id="checkin" name="checkin" type="date">
          <span class="help">Elige día de llegada</span>
        </p>
        <p class="field">
          <label for="checkout">Salida</label>
          <input required id="checkout" name="checkout" type="date">
          <span class="help">Noches: <strong id="nights">—</strong></span>
        </p>
      </div>

      <div class="grid cols-3">
        <p class="field">
          <label for="adultos">Adultos</label>
          <input id="adultos" name="adultos" type="number" min="1" value="2" inputmode="numeric">
        </p>
        <p class="field">
          <label for="ninos">Niños</label>
          <input id="ninos" name="ninos" type="number" min="0" value="0" inputmode="numeric">
        </p>
        <p class="field">
          <label for="telefono">Teléfono (opcional)</label>
          <input id="telefono" name="telefono" type="tel" autocomplete="tel" inputmode="tel" pattern="^[0-9+()\\s-]{7,}$">
          <span class="help">Para avisos de última hora</span>
        </p>
      </div>

      <p id="cap-note" class="note warn" hidden aria-live="polite">
        Sois <strong><span id="cap-total"></span></strong> personas.
        La capacidad estándar es de 10 plazas (8 + 2 en sofá cama).
        Si sois más, contádnoslo en el mensaje y valoramos el caso.
      </p>

      <input type="hidden" name="total_personas" id="total_personas" value="2">

      <p class="field">
        <label for="mensaje">Mensaje (opcional)</label>
        <textarea id="mensaje" name="mensaje" rows="4" placeholder="Cuéntanos detalles de tu estancia o dudas"></textarea>
      </p>

      <p class="inline">
        <input id="privacy" type="checkbox" required>
        <label for="privacy">He leído y acepto la <a href="/privacidad/">política de privacidad</a>.</label>
      </p>

      <!-- reCAPTCHA de Netlify -->
      <div data-netlify-recaptcha="true"></div>

      <p><button class="btn" type="submit">Enviar consulta</button></p>
    </form>
  </div>

  <div class="card">
    <h2>¿Prefieres reservar ya?</h2>
    <p>Puedes hacerlo directamente desde Rurive:</p>
    <p><a class="btn" href="{{ site.bookingHref }}" target="_blank" rel="noopener">Ir a Rurive</a></p>

    <h3>Familias</h3>
    <ul>
      <li>Bienvenidos bebés y niños. Cuna disponible bajo petición.</li>
      <li>Capacidad estándar: 8 personas (opción +2 en sofá cama).</li>
      <li>Indica edades para preparar la casa (trona, cuna...).</li>
    </ul>
  </div>
  <div class="card faq-mini">
    <h2>Dudas rápidas</h2>
    <ul>
      <li><a href="/la-casa/faq/#checkin">¿A qué hora es el check-in y el check-out?</a></li>
      <li><a href="/la-casa/faq/#capacidad">¿Cuánta gente puede alojarse?</a></li>
      <li><a href="/la-casa/faq/#barbacoa">¿Hay jardín y barbacoa?</a></li>
    </ul>
    <p>¿Más preguntas? <a href="/la-casa/faq/">Ver todas las preguntas frecuentes →</a></p>
  </div>
</section>



<script>
  // ===== Validación útil: fechas y noches =====
  const $in  = document.getElementById("checkin");
  const $out = document.getElementById("checkout");
  const $n   = document.getElementById("nights");

  const today = new Date(); today.setHours(0,0,0,0);
  const iso = d => d.toISOString().slice(0,10);

  $in.min = iso(today);

  function nextDay(d){ const x = new Date(d); x.setDate(x.getDate()+1); return x }
  function toDate(v){ const d = new Date(v); return isNaN(d) ? null : d }

  function updateLimits(){
    const di = toDate($in.value);
    if (di){
      $out.min = iso(nextDay(di));
      if ($out.value && toDate($out.value) <= di) $out.value = "";
    }
    updateNights();
  }

  function updateNights(){
    const di = toDate($in.value), doo = toDate($out.value);
    $out.setCustomValidity("");
    if (di && doo){
      const nights = Math.round((doo - di) / 86400000);
      if (nights <= 0){
        $out.setCustomValidity("La salida debe ser posterior a la entrada.");
      }
      $n.textContent = nights > 0 ? nights : "—";
    } else {
      $n.textContent = "—";
    }
  }

  $in.addEventListener("change", updateLimits);
  $out.addEventListener("change", updateNights);
  updateLimits();
</script>
<script>
// ===== Aviso por capacidad (>10) =====
const $adultos = document.getElementById("adultos");
const $ninos   = document.getElementById("ninos");
const $capNote = document.getElementById("cap-note");
const $capTotal = document.getElementById("cap-total");
const $capHidden = document.getElementById("total_personas");

function updateCapacity(){
  const a = parseInt($adultos.value || 0, 10);
  const k = parseInt($ninos.value || 0, 10);
  const total = (isNaN(a) ? 0 : a) + (isNaN(k) ? 0 : k);

  // Rellena total para que llegue en el email de Netlify Forms
  if ($capHidden) $capHidden.value = total;

  if ($capTotal)  $capTotal.textContent = total;

  // Mostrar aviso si excede 10; ocultar si no
  if ($capNote)   $capNote.hidden = total <= 10;
}

// Recalcular al cambiar adultos/niños
$adultos.addEventListener("input", updateCapacity);
$adultos.addEventListener("change", updateCapacity);
$ninos.addEventListener("input", updateCapacity);
$ninos.addEventListener("change", updateCapacity);

// Inicial
updateCapacity();
</script>
<script>
/* Mejora: reescala también si cambia el ancho del contenedor, no solo con resize */
(function(){
  const wrap = document.querySelector('form [data-netlify-recaptcha]');
  if(!wrap) return;

  const TARGET_W = 304, TARGET_H = 78;

  function fit(){
    const widget = wrap.querySelector('.g-recaptcha');
    if(!widget) return;
    const w = wrap.getBoundingClientRect().width;
    const s = Math.min(1, (w - 4) / TARGET_W);
    widget.style.transform = `scale(${s})`;
    widget.style.transformOrigin = '0 0';
    widget.style.width = TARGET_W + 'px';
    widget.style.margin = '0 auto';
    wrap.style.height = Math.ceil(TARGET_H * s) + 'px';
  }

  const obs = new MutationObserver(fit);
  obs.observe(wrap, { childList:true, subtree:true });

  /* NUEVO: detecta cambios de tamaño del propio wrap (por ejemplo, al rotar o cambiar grid) */
  if ('ResizeObserver' in window){
    new ResizeObserver(fit).observe(wrap);
  }

  window.addEventListener('resize', fit, { passive:true });
  document.addEventListener('DOMContentLoaded', fit);
  setTimeout(fit, 600);
})();
</script>



